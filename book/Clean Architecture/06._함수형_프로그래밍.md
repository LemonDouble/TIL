# Clean Architecture - 06. 함수형 프로그래밍

### Lambda

- 함수형 패러다임에서 핵심이 되는 계산법

- 25까지의 정수 제곱을 출력하는 코드를 JAVA로 짠다면?

```java
public class Squint{
	public static void main(String args[]){
		for(int i = 0; i < 25; i++){
			System.out.println(i*i);
		}
	}
}
```

- 같은 프로그램을 Clojure로 짠다면?

```clojure
(println (take 25( map ( fn [x] (* x x )) (range))))
```

- 여러 함수의 연쇄를 통해 문제를 해결한다!
    - println : 출력해라
    - take 25 : 처음부터 25까지
    - map : 각각에 대하여
    - fn [x] ( * x x ) : 제곱을 (lambda expression)
    - range(정수의)

- 따라서, 다음과 같이 작동된다. (가장 안쪽부터 보는 것이 좋다.)
    - range 함수는 0부터 시작해 끝없는 정수 List를 반환한다.
    - 반환된 정수 List는 map 함수로 전달되고, 제곱을 계산하는 Lambda 함수를 호출하여 끝없는 정수 제곱의 List를 생성한다.
    - 제곱된 List는 take 함수로 전달, 이 함수는 앞의 25개까지의 항목으로 구성된 새로운 리스트를 반환한다.
    - println 함수는 입력 값을 출력, 앞의 take 함수에 의해 얻어진 25개 값의 리스트다.
    - (프로그래밍에서 끝이 없는 리스트란 개념에 놀랄 수 있지만, 실제로 접근하기 전까진 평가되지 않는다.)

- 이 때 두 프로그램간의 큰 차이는 가변 변수(Mutable variable)의 유무
    - Java는 i라는 가변 변수가 있다.
    - Clojure는 이러한 가변 변수가 전혀 없다.
    - **함수형 언어에서, 변수는 절대 변경되지 않는다!!**

### 불변성과 아키텍쳐

- 가변 변수를 없애 어떤 이점을 얻을 수 있는가?
    - Race Condition, Deadlick, Concurrent update 문제가 해결된다.
    - 가변 변수가 없다면, 동시성 어플리케이션 (= 멀티 스레드, 멀티 프로세스)에서 생기는 문제를 해결할 수 있다.

- 그러면, 가변 변수를 없앨 수 있는가?
    - 자원이 무한하다면 가능하다.
    - 하지만 그렇지 않다면 타협을 해야 한다.

### 가변성의 분리

- 가장 주요한 타협 중 하나
- 어플리케이션 컴포넌트를 가변/불변 컴포넌트로 분리하는 것
- 불변 컴포넌트 : 함수형으로 작업된다. 하지만 가변 컴포넌트와 통신한다.
- 가변 컴포넌트 : 트랜잭션 메모리 등을 이용하여 변수를 보호한다.
    - 트랜잭션 메모리 : DB에서 하던 걸 메모리에서도 한다.

- 요약 :
    - 컴포넌트를 가변/불변 컴포넌트로 분리하고
    - 가능한 많은 컴포넌트를 불변 컴포넌트로 만들자!

### 이벤트 소싱(Event Sourcing)

- 은행 프로그램을 만든다면?
    - 트랜잭션을 처리해 계좌 잔고를 관리하는 대신, 트랜잭션을 전부 쌓아둔다면?
    - 가변 변수 없이도 은행 어플리케이션 구현이 가능하다!

- 하지만 현실적인 문제가 있다.
    - 시간이 지날수록 트랜잭션은 끝없이 증가, 컴퓨팅 자원이 끝없이 필요하다.
    - 하지만 어플리케이션 수명 주기 동안만 이런 전략을 취한다면?

- 이벤트 소싱
    - 상태가 아니라 트랜잭션을 모두 저장하자.
    - 상태가 필요해지는 시점에, 모든 트랜잭션을 처리하자.
    - 저장 공간은 싸다! 따라서, Cost가 비싸지 않다!

- 결과적으로 이벤트 소싱 이용하면 **CRUD**가 아닌 **CR**만 일어난다.
    - 변경/삭제 없으므로 동시성 문제 일어나지 않는다.

### 결론

- 구조적 프로그래밍 : 제어 흐름의 직접적 변화에 제한 (goto)
- 객체 지향 프로그래밍 : 제어 흐름의 간접적 전환에 제한
- 함수형 프로그래밍 : 변수 할당에 제한