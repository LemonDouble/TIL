# Clean Architecture - 11. DIP: 의존성 역전 원칙

### DIP : 의존성 역전 원칙

- 유연성이 극대화된 시스템이란, 의존성이 추상(abstraction)에 의존하며 구체(concretion)에는 의존하지 않는 시스템이다!

- 하지만 우리는 프로그램을 짤 때 구체적인 요소에 의존한다.
    - 예를 들어, Java의 String 객체는 구체 클래스지만, 의존하여 사용하는데 거부감이 없다.
    - 그 이유는 String 클래스는 매우 안정적이며, 잘 변경되지 않는다.
    - 따라서, 정확히는 **“변동성이 큰 (Volatile) 구체적 요소”** 에 의존하지 않는 것이 중요하다!

### 안정된 추상화

- Interface는 실 구현체보다 변동성이 낮다. (또한, 낮도록 노력해야 한다!)
- 따라서, 다음과 같은 구체적 실천법을 통해 DIP를 지킬 수 있다.
    - **변동성이 큰 구체 클래스를 참조하지 말 것**
        - 대신 추상 인터페이스를 참조하자!
    - **변동성이 큰 구체 클래스로부터 파생하지 말 것**
        - 상속 관계가 생기면 변경하기 어렵고, 새 의존성이 생긴다.
        - 꼭 필요하다면 꼭 열심히 고민한 후 사용하자.
    - **구체 함수를 오버라이드 하지 말 것**
        - 구체 함수는 소스 코드 의존성이 필요로 하고, 구체 함수를 오버라이드하면 이런 의존성 제거가 불가능하다.
        - 차라리 추상 함수를 선언하고 구현체에서 구현하는 식으로 만들자.
    - **구체적이며 변동성이 크다면, 절대 그 이름을 언급하지 마라!!**

### 팩토리

- DIP를 준수하기 위해, 변동성이 큰 구체적 객체는 주의해서 생성해야 한다.
- Java 등, 대부분의 OO 언어에서는 이런 문제 해결을 위해, 추상 팩토리를 사용한다.

![Untitled](https://github.com/LemonDouble/TIL/blob/main/book/Clean%20Architecture/image/Untitled4.png)

- Application은 Service 인터페이스를 통해 ConcreateImpl을 사용
    - 어찌 됐건, ConcreateImpl을 사용하므로, Application은 ConcreateImpl을 생성해야 한다.
    - 하지만, Application은 ConcreateImpl 이란 구체 객체에 의존성을 만들기 싫다.
    - 따라서, ServiceFactory의 makeSvc() 메서드만 호출한다.
    - makeSvc() 메서드는, ServiceFactory 인터페이스로부터 파생된 ServiceFactoryImpl 에서 실제로 구현된다.
    - 그리고 ServiceFactoryImpl 구현체가 ConcreateImpl 인스턴스를 생성한 후, Service 타입으로 반환한다.
- 이러한 구조를 통해, Application은 ConcreateImpl에 의존성 없이 사용이 가능하다.
- 곡선을 통해 “추상 컴포넌트” 와 “구체 컴포넌트”를 구분할 수 있다.
    - 추상 컴포넌트는, 어플리케이션의 고수준 비즈니스 로직을 명세한다.
    - 구체 컴포넌트는, 비즈니스 로직 구현을 위한 모든 세부사항을 포함한다.

- 이때, 제어의 흐름은 소스 코드 의존성의 정 반대로 곡선을 가르지른다.
    - 이를 제어의 역전 (Dependency Injection) 이라고 한다.

### 구체 컴포넌트

- 위 그림에서 구체 컴포넌트간에는 구체적 의존성이 존재한다.
    - ServiceFactoryImpl은 구체 컴포넌트인 ConcreateImpl에 의존한다.
- 이것은 DIP 위반이지만, 일반적인 일이다.
    - DIP 위배를 모두 없애는 것은 불가능하다!
- 대신, DIP를 위배하는 구체 클래스들을 최소화 후 모을 수 있고, 이를 시스템의 나머지 부분과 분리할 수 있다.

### 결론

- DIP는 아주 아주 아주 중요하다!
- 위의 곡선 (추상과 구체 컴포넌트를 구분) 하는 것은 아키텍쳐의 경계가 될 것이다.
- 의존성은 곡선을 경계로, 항상 더 추상적인 엔티티가 있는 곳으로만 향한다.
    - 이걸을 의존성 규칙 (Dependency Rule) 이라고 한다!